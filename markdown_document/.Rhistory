text <- paste(text,text_uppräkning,", där andelen svarande var upp emot ",round(extremer$Svarsfrekvens[1])," %. ",sep="")
} else {
svarsgrad_max <- slice(svarsgrad,which.max(Svarsfrekvens))
text <- paste(text,"Högst andel svarande återfinns i ",svarsgrad_max$Område,", där andelen svarande var ",round(svarsgrad_max$Svarsfrekvens)," %.",sep="")
}
extremer <- svarsgrad_extremer_låga
if (nrow(extremer)>1){ #om det finns extremer
#slice(which.max(Svarsfrekvens))
text <- paste(text,"Särskilt hög andel svarande återfinns i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen svarande var upp emot ",round(extremer$Svarsfrekvens[1])," %. ",sep="")
} else {
svarsgrad_min <- slice(svarsgrad,which.min(Svarsfrekvens))
text <- paste(text,"Lägst andel svarande återfinns i ",svarsgrad_min$Område,", där andelen svarande var nära ",round(svarsgrad_min$Svarsfrekvens)," %.",sep="")
}
text <- paste(text,"Notera att hela befolkningen inte har blivit tillfrågad. Svarsfrekvensen bland de tillfrågade är inte känd.")
#textvariabler till kommande textstycke
if (nivå == 'deso')
nivånivå <- 'DeSO-nivå'
if (nivå == 'tätort')
nivånivå <- 'tätorts'
if (nivå == 'kommun')
nivånivå <- 'kommun'
antal_individer <- nrow(pers)
kbl(svarsgrad_tabell, caption = "Antal svar jämfört med befolkningen (15 år och äldre) i respektive område", booktabs = T, linesep = "") %>%
kable_styling(latex_options = c("striped", "HOLD_position")) %>%
row_spec(nrow(svarsgrad_tabell), bold = T) %>% #making the Total row bold
row_spec(0, bold = T) #making the header row bold
#kable(respondenter, caption = "Antal svar per kön och åldersgrupp")
kbl(respondenter_tabell, caption = "Antal svar per kön och åldersgrupp", booktabs = T, linesep = "") %>%
kable_styling(latex_options = c("striped", "HOLD_position")) %>%
row_spec(nrow(respondenter_tabell), bold = T) %>% #making the Total row bold
row_spec(0, bold = T) #making the header row bold
korkort_bil <- pers %>%
mutate(Område = ifelse(is.na(Område), "Ej angivet", Område)) %>%
select(Område, h4, h5) %>%
group_by(Område) %>%
summarize(korkort_bil = sum(na.omit(h4) == 1),
Biltillgång = sum(h5 == 1) + sum(h5 == 2) + sum(h5 == 3) + sum(h5 == 4),
Antal_individer = n()) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
mutate("Körkort (%)" = korkort_bil/Antal_individer*100,
"Biltillgång (%)" = Biltillgång/Antal_individer*100) %>%
select(Område, "Körkort (%)", "Biltillgång (%)")
korkort_bil <- korkort_bil
körkort_totalt <- korkort_bil %>%
filter(Område == "Totalt") %>%
select("Körkort (%)")
biltillgång_totalt <- korkort_bil %>%
filter(Område == "Totalt") %>%
select("Biltillgång (%)")
körkort_min <- min(korkort_bil$"Körkort (%)")
#Försök att filtrera ut extremvärden för att kunna skriva om dem i texten.
korkort_bil_extremer_höga <- extremer_höga(korkort_bil,"Körkort (%)")
korkort_bil_extremer_låga <- extremer_låga(korkort_bil,"Körkort (%)")
##### Stycke som presenterar svarsgraden #####
text <- ""
max_antal_uppräknade <- 3 #hur många områden som maximalt ska lyftas fram
extremer <- korkort_bil_extremer_höga
if (nrow(extremer)>1){ #om det finns extremer
#slice(which.max(Svarsfrekvens))
text <- paste(text,"Särskilt högt var bilinnehavet bland människor i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var upp emot ",round(extremer$Svarsfrekvens[1])," %. ",sep="")
} else {
svarsgrad_max <- slice(svarsgrad,which.max(Svarsfrekvens))
text <- paste(text,"Högst bilinnehav återfanns i ",svarsgrad_max$Område,", med ",round(svarsgrad_max$Svarsfrekvens)," %.",sep="")
}
extremer <- korkort_bil_extremer_låga
if (nrow(extremer)>1){ #om det finns extremer
#slice(which.max(Svarsfrekvens))
text <- paste(text,"Särskilt låg andel körkortsinnehavare återfanns i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var ner emot ",round(extremer$Svarsfrekvens[1])," %. ",sep="")
} else {
svarsgrad_min <- slice(svarsgrad,which.min(Svarsfrekvens))
text <- paste(text,"Lägst var bilinnehavet i ",svarsgrad_min$Område,", där andelen var nära ",round(svarsgrad_min$Svarsfrekvens)," %. ",sep="")
}
kbl(korkort_bil, caption = "Antal respondenter med körkort och biltillgång", booktabs = T, linesep = "",digits=1) %>%
kable_styling(latex_options = c("striped", "HOLD_position")) %>%
row_spec(nrow(korkort_bil), bold = T) %>% #making the Total row bold
row_spec(0, bold = T) #making the Header row bold
num_trips_per_pers <- rvu %>%
select(respondentid) %>%
group_by(respondentid) %>%
summarize(num_trips = n())
befolkning_per_område <- pers %>%
select(respondentid, kon) %>%
left_join(num_trips_per_pers, by = c("respondentid" = "respondentid")) %>%
filter(!is.na(num_trips)) %>%
left_join(respondent2område, by = c("respondentid" = "respondentid")) %>%
group_by(Område,Område_kod) %>%
summarize() %>%
left_join(deso_befolkning, by = c("Område_kod" = "Område_kod"))
vars <- c("Antal personer", "Resor per dag för alla personer")
num_trips_gender <- pers %>%
select(respondentid, kon) %>%
left_join(num_trips_per_pers, by = c("respondentid" = "respondentid")) %>%
group_by(kon) %>%
summarize("Andel personer som rest (%)" = 100*sum(!is.na(num_trips)) / n(),
"Resor per dag för alla personer" = sum(num_trips, na.rm = TRUE) / n(),
"Resor per dag för personer som rest" = mean(num_trips, na.rm = TRUE)) %>%
rename('Grupp' = kon) %>%
mutate('Befolkning' = c(sum(befolkning_per_område$Kvinnor,na.rm = TRUE),sum(befolkning_per_område$Män,na.rm = TRUE),0),
'Antal resor' = round(.data[["Befolkning"]] * .data[["Resor per dag för alla personer"]]))
num_trips_age <- pers %>%
mutate(alder = ifelse(is.na(alder), "Ej angivet", alder)) %>%
select(respondentid, alder) %>%
left_join(num_trips_per_pers, by = c("respondentid" = "respondentid")) %>%
group_by(alder = cut(alder, breaks = c(12, 24, 64, 150))) %>%
summarize("Andel personer som rest (%)" = 100*sum(!is.na(num_trips)) / n(),
"Resor per dag för alla personer" = sum(num_trips, na.rm = TRUE) / n(),
"Resor per dag för personer som rest" = mean(num_trips, na.rm = TRUE)) %>%
mutate(alder = c("Mellan 15 och 24", "Mellan 25 och 64", "Mellan 65 och 85")) %>%
rename('Grupp' = alder) %>%
mutate('Befolkning' = c(sum(befolkning_per_område$Ålder_15_24,na.rm = TRUE),sum(befolkning_per_område$Ålder_25_64,na.rm = TRUE),sum(befolkning_per_område$Ålder_65,na.rm = TRUE)),
'Antal resor' = round(.data[["Befolkning"]] * .data[["Resor per dag för alla personer"]]))
num_trips_all <- pers %>%
select(respondentid) %>%
left_join(num_trips_per_pers, by = c("respondentid" = "respondentid")) %>%
#group_by(kon) %>%
summarize("Andel personer som rest (%)" = 100*sum(!is.na(num_trips)) / n(),
"Resor per dag för alla personer" = sum(num_trips, na.rm = TRUE) / n(),
"Resor per dag för personer som rest" = mean(num_trips, na.rm = TRUE)) %>%
mutate('Grupp' = "Alla",
'Befolkning' = sum(befolkning_per_område$Befolkning,na.rm = TRUE),
'Antal resor' = round(.data[["Befolkning"]] * .data[["Resor per dag för alla personer"]]))
num_trips_rep <- num_trips_gender %>%
rbind(num_trips_age) %>%
rbind(num_trips_all)
num_trips_män <- num_trips_gender %>%
filter(Grupp == "Man") %>%
select("Resor per dag för alla personer")
num_trips_kvinnor <- num_trips_gender %>%
filter(Grupp == "Kvinna") %>%
select("Resor per dag för alla personer")
avvikelse <- abs((num_trips_män-num_trips_kvinnor)/(num_trips_kvinnor+num_trips_män))
if (num_trips_män > num_trips_kvinnor) {
kön1 <- "män"
kön2 <- "kvinnor"
} else {
kön1 <- "kvinnor"
kön2 <- "män"
}
konjunktion <- ""
if (avvikelse>0.032) {
if (avvikelse>0.064) {
text <- paste("I genomsnitt gjorde ",kön1," mycket fler resor än ",kön2,". ",sep="")
} else {
text <- paste("I genomsnitt gjorde ",kön1," något fler resor än ",kön2,". ",sep="")
}} else {
text <- paste("I genomsnitt reste både ",kön1," och ",kön2," i lika stor utsträckning. ",sep="")
konjunktion <- "heller "
}
avvikelse <- sd(num_trips_age$"Resor per dag för alla personer", na.rm=TRUE)
if (avvikelse<0.1) {
text <- paste(text,"De olika åldersgrupperna skilde sig inte ",konjunktion,"märkbart i antal resor per dag. ",sep="")
}
# kbl(num_trips_gender, digits = 2, caption = "Antal resor per dag per kön", booktabs = T, linesep = "") %>%
#   kable_styling(latex_options = c("striped", "HOLD_position")) %>%
#   row_spec(0, bold = T, angle = 45) #making the Header row bold and titles angled for space
x <- kbl(num_trips_rep, digits = 1, longtable = T, booktabs = T, linesep = "",caption = "Antal resor per dag per kön") %>%
#Captions appear to create problems with longtable package, gives error "mispaced align"
#See here for solution, but don't know how to implement:
#https://tex.stackexchange.com/a/205468
kable_styling(latex_options = c("striped", "HOLD_position", "repeat_header"),
repeat_header_text = "\\textit{(fortsättning)}",
repeat_header_continued = "\\textit{(Fortsätter på nästa sida...)}") %>%
#row_spec(nrow(reslangd_per_omrade_rep), bold = T) %>% #making the Total row bold
row_spec(0, bold = T) %>% #making the Header row bold
column_spec(2:4, width = "2.5cm") %>%
column_spec(1:1, width = "2.7cm") %>%
column_spec(5:6, width = "2cm")
for (i in c(1:2)){
x <- x %>%
pack_rows(c('Kön','Ålder')[i], (i-1)*3+1, (i-1)*3+3,
hline_after = TRUE)
}
x <- x %>%
pack_rows("Totalt", 7, 7,
hline_after = TRUE,
hline_before = TRUE)
x
mode_per_pers <- rvu %>%
select(respondentid, fardmedel.kat) %>%
group_by(respondentid) %>%
summarize(Bil = any(fardmedel.kat == "Bil", na.rm = TRUE),
Tåg = any(fardmedel.kat == "Tåg", na.rm = TRUE),
Buss = any(fardmedel.kat == "Buss", na.rm = TRUE),
Cykel = any(fardmedel.kat == "Cykel", na.rm = TRUE),
Gång = any(fardmedel.kat == "Gång", na.rm = TRUE),
Övrigt = any(fardmedel.kat == "Annat" | fardmedel.kat == 7, na.rm = TRUE))
trip_mode <- pers %>%
select(respondentid, Område)%>%
left_join(mode_per_pers, by = c("respondentid" = "respondentid")) %>%
filter(!is.na(Område)) %>%
group_by(Område) %>%
summarize("Bil" = sum(Bil),
"Tåg" = sum(Tåg),
"Buss" = sum(Buss),
"Cykel" = sum(Cykel),
"Gång" = sum(Gång),
"Övrigt" = sum(Övrigt),
"Alla" = Bil + Tåg + Buss + Cykel + Gång + Övrigt) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt")))
trip_person_mode <- trip_mode %>%
mutate("Bil" = 100*Bil / Alla,
"Tåg" = 100*Tåg / Alla,
"Buss" =  100*Buss / Alla,
"Cykel" = 100*Cykel / Alla,
"Gång" = 100*Gång / Alla,
"Övrigt" = 100*Övrigt / Alla) %>%
select(-Alla)
which.max(trip_person_mode$Bil)
which.min(trip_person_mode$Bil)
View(trip_person_mode)
trip_person_mode[1,6]
trip_person_mode[1]
trip_person_mode[1,6]
trip_person_mode[6,1]
trip_person_mode[6,Område]
trip_person_mode[6,"Område"]
trip_person_mode_extremer_höga <- extremer_höga(trip_person_mode,"Bil")
trip_person_mode_extremer_låga <- extremer_låga(trip_person_mode,"Bil")
View(trip_person_mode_extremer_låga)
trip_person_mode[6,"Område"]
mest_frekvent_andel
#Räknar ut vanligaste färdmedlet i respektive område
trip_person_mode_max <- trip_person_mode %>%
mutate('max' = names(trip_person_mode)[2:7][max.col(trip_person_mode[2:7], "first")])
#Plockar ut det vanligaste färdmedlet totalt sett
mest_frekvent <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(max)
#Plockar ut det vanligaste färdmedlets andelar
mest_frekvent_andel <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(pull(mest_frekvent))
mest_frekvent_andel
mest_frekvent
trip_person_mode_extremer_höga <- extremer_höga(trip_person_mode,mest_frekvent_färdmedel)
mest_frekvent_färdmedel <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(max)
trip_person_mode <- trip_mode %>%
mutate("Bil" = 100*Bil / Alla,
"Tåg" = 100*Tåg / Alla,
"Buss" =  100*Buss / Alla,
"Cykel" = 100*Cykel / Alla,
"Gång" = 100*Gång / Alla,
"Övrigt" = 100*Övrigt / Alla) %>%
select(-Alla)
#Räknar ut vanligaste färdmedlet i respektive område
trip_person_mode_max <- trip_person_mode %>%
mutate('max' = names(trip_person_mode)[2:7][max.col(trip_person_mode[2:7], "first")])
#Plockar ut det vanligaste färdmedlet totalt sett
mest_frekvent_färdmedel <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(max)
#Plockar ut det vanligaste färdmedlets andelar
mest_frekvent_andel <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(pull(mest_frekvent_färdmedel))
#Skapar en lista med områden som har ett avvikande vanligaste färdmedel
avvikande_vanligaste_färdmedel <- trip_person_mode_max %>%
filter(max != pull(mest_frekvent_färdmedel))
trip_person_mode_extremer_höga <- extremer_höga(trip_person_mode,mest_frekvent_färdmedel)
mest_frekvent_färdmedel <- pull(mest_frekvent_färdmedel)
trip_person_mode_extremer_höga <- extremer_höga(trip_person_mode,mest_frekvent_färdmedel)
trip_person_mode_extremer_låga <- extremer_låga(trip_person_mode,mest_frekvent_färdmedel)
mest_frekvent_andel <- trip_person_mode_max %>%
filter(Område == "Totalt")
View(mest_frekvent_andel)
totalt_resor <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
mest_frekvent_andel <- select(totalt_resor,mest_frekvent_färdmedel)
trip_person_mode[nrow(trip_person_mode),"Område"]
trip_person_mode[nrow(trip_person_mode),"Bil"]
trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel]
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
mest_frekvent_andel <- pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
pull(svarsgrad[nrow(svarsgrad),Svarsfrekvens])
pull(svarsgrad[nrow(svarsgrad),"Svarsfrekvens"])
pull(korkort_bil[nrow(korkort_bil),"Körkort (%)"])
korkort_bil %>%
filter(Område == "Totalt") %>%
select("Körkort (%)")
körkort_totalt <- korkort_bil %>%
filter(Område == "Totalt") %>%
select("Körkort (%)")
körkort_totalt
biltillgång_totalt <- korkort_bil %>%
filter(Område == "Totalt") %>%
select("Biltillgång (%)")
biltillgång_totalt
pull(korkort_bil[nrow(korkort_bil),"Biltillgång (%)"])
mest_frekvent_färdmedel <- trip_person_mode_max %>%
filter(Område == "Totalt") %>%
select(max)
mest_frekvent_färdmedel
pull(trip_person_mode_max[nrow(trip_person_mode_max),"max"])
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
mest_frekvent_färdmedel
mest_frekvent_färdmedel
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
pull(trip_person_mode[nrow(trip_person_mode),"Bil"])
mest_frekvent_färdmedel
pull(mest_frekvent_färdmedel)
mest_frekvent_färdmedel <- pull(trip_person_mode_max[nrow(trip_person_mode_max),"max"])
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
mest_frekvent_andel <- pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
pull(trip_person_mode[nrow(trip_person_mode),"Cykel"])
slice(svarsgrad,which.max(col))
svarsgrad_max <- slice(svarsgrad,which.max(col))
tabell <- trip_person_mode
slice(tabell,which.max(col))
tabell <- trip_person_mode
col <- mest_frekvent_färdmedel
col
slice(tabell,which.max("col"Bil))
slice(tabell,which.max("Bil"))
tabell
slice(tabell,which.max(col))
tabell_max <- tabell %>%
slice(tabell,which.max(col))
tabell_max <- tabell %>%
slice(which.max(col))
View(tabell_max)
slice(tabell,which.min(Bil))
slice(tabell,which.max(mest_frekvent_färdmedel))
View(tabell)
slice(tabell,which.max("Cykel")))
slice(tabell,which.max("Cykel"))
slice(tabell,which.max(Cykel))
andel_resor_cykel_max <- slice(trip_person_mode,which.max(Cykel))
andel_resor_cykel_max
andel_resor_cykel_max[Område]
andel_resor_cykel_max["Område"]
pull(andel_resor_cykel_max["Område"])
tabell_max
tabell_min
tabell_min <- slice(tabell,which.min(mest_frekvent_färdmedel))
tabell_min
tabell_max <- slice(tabell,which.max(mest_frekvent_färdmedel))
tabell_max <- slice(tabell,which.max(Bil))
slice(tabell,which.max(Bil))
mode_per_pers <- rvu %>%
select(respondentid, fardmedel.kat) %>%
group_by(respondentid) %>%
summarize(Bil = any(fardmedel.kat == "Bil", na.rm = TRUE),
Tåg = any(fardmedel.kat == "Tåg", na.rm = TRUE),
Buss = any(fardmedel.kat == "Buss", na.rm = TRUE),
Cykel = any(fardmedel.kat == "Cykel", na.rm = TRUE),
Gång = any(fardmedel.kat == "Gång", na.rm = TRUE),
Övrigt = any(fardmedel.kat == "Annat" | fardmedel.kat == 7, na.rm = TRUE))
trip_mode <- pers %>%
select(respondentid, Område)%>%
left_join(mode_per_pers, by = c("respondentid" = "respondentid")) %>%
filter(!is.na(Område)) %>%
group_by(Område) %>%
summarize("Bil" = sum(Bil),
"Tåg" = sum(Tåg),
"Buss" = sum(Buss),
"Cykel" = sum(Cykel),
"Gång" = sum(Gång),
"Övrigt" = sum(Övrigt),
"Alla" = Bil + Tåg + Buss + Cykel + Gång + Övrigt) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt")))
trip_person_mode <- trip_mode %>%
mutate("Bil" = 100*Bil / Alla,
"Tåg" = 100*Tåg / Alla,
"Buss" =  100*Buss / Alla,
"Cykel" = 100*Cykel / Alla,
"Gång" = 100*Gång / Alla,
"Övrigt" = 100*Övrigt / Alla) %>%
select(-Alla)
#Räknar ut vanligaste färdmedlet i respektive område
trip_person_mode_max <- trip_person_mode %>%
mutate('max' = names(trip_person_mode)[2:7][max.col(trip_person_mode[2:7], "first")])
#Plockar ut det vanligaste färdmedlet totalt sett
mest_frekvent_färdmedel <- pull(trip_person_mode_max[nrow(trip_person_mode_max),"max"])
#Plockar ut det vanligaste färdmedlets andelar
mest_frekvent_andel <- pull(trip_person_mode[nrow(trip_person_mode),mest_frekvent_färdmedel])
#Skapar en lista med områden som har ett avvikande vanligaste färdmedel
avvikande_vanligaste_färdmedel <- trip_person_mode_max %>%
filter(max != mest_frekvent_färdmedel)
#Sandlåda
#test <- trip_person_mode %>%
#  min
#trip_person_mode[which.min(trip_person_mode$Bil),"Område"]
#svarsgrad_min <- slice(svarsgrad,which.min(Svarsfrekvens))
#Filtrerar ut extremvärden för att kunna skriva om dem i texten.
trip_person_mode_extremer_höga <- extremer_höga(trip_person_mode,mest_frekvent_färdmedel)
trip_person_mode_extremer_låga <- extremer_låga(trip_person_mode,mest_frekvent_färdmedel)
#Producerar brödtext.
text <- paste(mest_frekvent_färdmedel," är det vanligaste färdmedlet i ",rapportområde," med ",round(pull(mest_frekvent_andel))," procent av alla resorna.")
#Producerar brödtext.
text <- paste(mest_frekvent_färdmedel," är det vanligaste färdmedlet i ",rapportområde," med ",round(mest_frekvent_andel)," procent av alla resorna.")
if (nrow(avvikande_vanligaste_färdmedel) > 0) {
text <- paste(text,"I zon ")
#Uppräkning av områden
antal_uppräknade <- nrow(avvikande_vanligaste_färdmedel) #som minst räknas alla områden upp
text_uppräkning <- paste(avvikande_vanligaste_färdmedel$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning," var dock ",avvikande_vanligaste_färdmedel$max[1]," det vanligaste färdmedlet. ",sep="")
} else{
text <- paste(text,mest_frekvent_färdmedel," är också det vanligaste färdmedlet i varje enskilt område.")
}
#OBS hårdkodat med Bil, ska vara mest_frekvent_färdmedel
extremer <- trip_person_mode_extremer_höga
tabell <- trip_person_mode
if (nrow(extremer)>1){ #om det finns extremer
text <- paste(text,"Särskilt högt var antalet ",mest_frekvent_färdmedel,"resor bland människor i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var upp emot ",round(extremer$Bil[1])," %. ",sep="")
} else {
tabell_max <- slice(tabell,which.max(Bil))
text <- paste(text,"Högst andel återfanns i ",tabell_max$Område,", med ",round(svarsgrad_max$Bil)," %.",sep="")
}
svarsgrad_max
#OBS hårdkodat med Bil, ska vara mest_frekvent_färdmedel
extremer <- trip_person_mode_extremer_höga
tabell <- trip_person_mode
if (nrow(extremer)>1){ #om det finns extremer
text <- paste(text,"Särskilt högt var antalet ",mest_frekvent_färdmedel,"resor bland människor i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var upp emot ",round(extremer$Bil[1])," %. ",sep="")
} else {
tabell_max <- slice(tabell,which.max(Bil))
text <- paste(text,"Högst andel återfanns i ",tabell_max$Område,", med ",round(tabell_max$Bil)," %.",sep="")
}
extremer <- trip_person_mode_extremer_låga
if (nrow(extremer)>1){ #om det finns extremer
text <- paste(text,"Särskilt låg andel ",mest_frekvent_färdmedel,"resor återfanns i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var ner emot ",round(extremer$Bil[1])," %. ",sep="")
} else {
tabell_min <- slice(tabell,which.min(Bil))
text <- paste(text,"Lägst var andelen i ",tabell_min$Område,", där andelen var nära ",round(svarsgrad_min$Bil)," %. ",sep="")
}
#Producerar brödtext.
text <- paste(mest_frekvent_färdmedel," är det vanligaste färdmedlet i ",rapportområde," med ",round(mest_frekvent_andel)," procent av alla resorna.")
if (nrow(avvikande_vanligaste_färdmedel) > 0) {
text <- paste(text,"I zon ")
#Uppräkning av områden
antal_uppräknade <- nrow(avvikande_vanligaste_färdmedel) #som minst räknas alla områden upp
text_uppräkning <- paste(avvikande_vanligaste_färdmedel$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning," var dock ",avvikande_vanligaste_färdmedel$max[1]," det vanligaste färdmedlet. ",sep="")
} else{
text <- paste(text,mest_frekvent_färdmedel," är också det vanligaste färdmedlet i varje enskilt område.")
}
#OBS hårdkodat med Bil, ska vara mest_frekvent_färdmedel
extremer <- trip_person_mode_extremer_höga
tabell <- trip_person_mode
if (nrow(extremer)>1){ #om det finns extremer
text <- paste(text,"Särskilt högt var antalet ",mest_frekvent_färdmedel,"resor bland människor i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var upp emot ",round(extremer$Bil[1])," %. ",sep="")
} else {
tabell_max <- slice(tabell,which.max(Bil))
text <- paste(text,"Högst andel återfanns i ",tabell_max$Område,", med ",round(tabell_max$Bil)," %.",sep="")
}
extremer <- trip_person_mode_extremer_låga
if (nrow(extremer)>1){ #om det finns extremer
text <- paste(text,"Särskilt låg andel ",mest_frekvent_färdmedel,"resor återfanns i ")
#Uppräkning av områden
antal_uppräknade <- min(nrow(extremer),max_antal_uppräknade) #som minst räknas alla områden upp
text_uppräkning <- paste(extremer$Område[1:(antal_uppräknade)], collapse = ', ') #sträng med områden
text_uppräkning <- stri_replace_last_fixed(text_uppräkning, ', ', ' och ') #sätter "och" i slutet av uppräkningen
text <- paste(text,text_uppräkning,", där andelen var ner emot ",round(extremer$Bil[1])," %. ",sep="")
} else {
tabell_min <- slice(tabell,which.min(Bil))
text <- paste(text,"Lägst var andelen i ",tabell_min$Område,", där andelen var nära ",round(tabell_min$Bil)," %. ",sep="")
}
#För att kommentera antalet cykelresor
if (mest_frekvent_färdmedel != "Cykel") {
andel_resor_cykel <- pull(trip_person_mode[nrow(trip_person_mode),"Cykel"])
andel_resor_cykel_max <- slice(trip_person_mode,which.max(Cykel))
text <- paste(text," Andelen cyklister var i genomsnitt ",andel_resor_cykel," %. Högst andel cyklister återfanns i ",pull(andel_resor_cykel_max["Område"])," med en andel på ",pull(andel_resor_cykel_max["Cykel"])," %. ")
}
text
tabell_min
