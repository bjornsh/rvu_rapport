across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix <- od_matrix %>%
mutate(start_tatort_namn="Övrigt")
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- od_matrix2 %>%
mutate(start_tatort_namn="Övrigt") %>%
rbind(od_matrix)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(start_tatort_namn="Övrigt")
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övrigt")
od_matrix <- rbind(od_matrix2)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övrigt")
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övrigt")
od_matrix <- rbind(od_matrix2)
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övrigt")
od_matrix <- rbind(od_matrix,od_matrix2)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övriga områden")
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix2  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix2 <- mutate(od_matrix2,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix2)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix_övriga)
od_matrix <- od_matrix[-c(minsta_antal_resor+1)]
od_matrix <- od_matrix[-c(minsta_antal_resor+1)]
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix_övriga)
od_matrix <- od_matrix[-c(minsta_antal_resor+1),0]
View(od_matrix)
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix_övriga)
od_matrix <- od_matrix[-c(minsta_antal_resor+1),]
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix_övriga)
od_matrix <- od_matrix[-c(minsta_antal_resor+1),]
View(od_matrix)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix,od_matrix_övriga)
od_matrix <- od_matrix[-c(minsta_antal_resor+1),]
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:9],Totaltc) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totaltc)
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix_tot <- od_matrix[minsta_antal_resor]
od_matrix_tot <- mutate(od_matrix_övriga,start_tatort_namn="Totalt")
od_matrix <- rbind(od_matrix,od_matrix_övriga,od_matrix_tot)
od_matrix <- od_matrix[-c(minsta_antal_resor,minsta_antal_resor+1),]
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix_tot <- od_matrix[minsta_antal_resor-1]
od_matrix_tot <- mutate(od_matrix_övriga,start_tatort_namn="Totalt")
od_matrix <- rbind(od_matrix,od_matrix_övriga,od_matrix_tot)
od_matrix <- od_matrix[-c(minsta_antal_resor,minsta_antal_resor+1),]
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totaltr"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix_tot <- od_matrix[minsta_antal_resor]
od_matrix_tot <- mutate(od_matrix_tot,start_tatort_namn="Totalt")
od_matrix <- rbind(od_matrix,od_matrix_övriga,od_matrix_tot)
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix_tot <- od_matrix[minsta_antal_resor]
od_matrix_tot <- mutate(od_matrix_tot,start_tatort_namn="Totalt")
od_matrix <- rbind(od_matrix,od_matrix_övriga,od_matrix_tot)
od_matrix
od_matrix[1,]
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal_resor-1,],od_matrix[minsta_antal_resor+1,],od_matrix[minsta_antal_resor,])
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal_resor-1,],od_matrix_övriga,od_matrix[minsta_antal_resor,])
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:9],Totaltc) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totaltc)
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
minsta_antal_resor <- 10
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup() %>%
mutate("Totaltc" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal_resor) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal_resor, -1]- od_matrix[minsta_antal_resor+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal_resor-1,],od_matrix_övriga,od_matrix[minsta_antal_resor,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal_resor-1],Totaltc) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totaltc) %>%
relocate(Totaltc, .after = "Övriga områden")
