od_matrix[minsta_antal, -1]
2*od_matrix[minsta_antal-1,-1]
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso) %>%
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
#rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
od_matrix_perc <- as.data.frame(od_matrix)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal)
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal,])
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal)
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal-1,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal)
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal-1,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
od_matrix_perc <- as.data.frame(od_matrix) #konverterar till dataframe
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort" #Skapar indexkolumn
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort")) #Tar bort gammal kolumn
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal-1,])
od_matrix_perc[Totalt,Totalt]
od_matrix_perc[Totalt]
od_matrix_perc
od_matrix_perc["Totalt","Totalt"]
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
filter(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde) %>%
select(start_deso, stop_deso) %>%
filter(!is.na(start_deso)) %>%
filter(!is.na(stop_deso)) %>%
group_by(start_deso, stop_deso) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_deso, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal)
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_deso)
od_matrix <- od_matrix %>%
select(start_deso,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_deso)
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix) #konverterar till dataframe
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort" #Skapar indexkolumn
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort")) #Tar bort gammal kolumn
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal-1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(start_tatort_namn != rapportområde & stop_tatort_namn != rapportområde) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort",Totalt))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal,])
od_matrix_perc <- round(od_matrix_perc/sum(od_matrix_perc)*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(start_tatort_namn != rapportområde & stop_tatort_namn != rapportområde) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(!(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
od_matrix_perc <- as.data.frame(od_matrix)
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(!(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[1:minsta_antal+1,])
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[0:minsta_antal+1,])
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(!(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[0:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
View(od_matrix_perc)
minsta_antal <- 10
#Skapar od-matris för alla resor
od_matrix <- rvu %>%
select(start_tatort_namn, stop_tatort_namn) %>%
filter(!is.na(start_tatort_namn)) %>%
filter(!is.na(stop_tatort_namn)) %>%
filter(!(start_tatort_namn == rapportområde & stop_tatort_namn == rapportområde)) %>%
group_by(start_tatort_namn, stop_tatort_namn) %>%
summarize(antal = n()) %>%
pivot_wider(names_from = stop_tatort_namn, values_from = antal, values_fill = 0) %>%
ungroup()
#Sparar OD-matris som csv
write.csv(od_matrix, "od_matrix.csv")
#Filtrerar ut populäraste områden samt skapar total och övriga områden
od_matrix <- od_matrix %>%
mutate("Totalt" = rowSums(select_if(., is.numeric), na.rm = TRUE)) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Totalt"))) %>%
top_n(minsta_antal) %>%
bind_rows(summarize(.,
across(where(is.numeric), sum),
across(where(is.character), ~ "Övriga områden")))
#Skapar övrigt-rad
od_matrix_övriga  <- 2*od_matrix[minsta_antal, -1]- od_matrix[minsta_antal+1,-1]
od_matrix_övriga <- mutate(od_matrix_övriga,start_tatort_namn="Övriga områden")
od_matrix <- rbind(od_matrix[1:minsta_antal-1,],od_matrix_övriga,od_matrix[minsta_antal,])
#Filtrerar bort kolumner
lista_med_tätorter <- pull(od_matrix,start_tatort_namn)
od_matrix <- od_matrix %>%
select(start_tatort_namn,lista_med_tätorter[1:minsta_antal-1],Totalt) %>%
rename("Från tärort" = start_tatort_namn) %>%
mutate("Övriga områden" = -rowSums(select_if(., is.numeric), na.rm = TRUE)+2*Totalt) %>%
relocate(Totalt, .after = "Övriga områden")
#Skapar procent-matris
od_matrix_perc <- as.data.frame(od_matrix)
rownames(od_matrix_perc) <- od_matrix_perc$"Från tärort"
od_matrix_perc <- select(od_matrix_perc,!c("Från tärort"))
od_matrix_perc <- rbind(od_matrix_perc[0:minsta_antal+1,])
od_matrix_perc <- round(od_matrix_perc/od_matrix_perc["Totalt","Totalt"]*100)
